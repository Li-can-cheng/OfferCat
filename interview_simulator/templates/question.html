<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interview Questions</title>
    <script src="{{ url_for('static', filename='js/ui/marked.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ui/highlight.min.js') }}"></script>
</head>
<body>
    <h1>Interview Questions</h1>
    
    <div id="connectionStatus"></div>
    <form id="interviewForm" action="/stream_questions" method="POST">
        <button type="submit">生成面试问题</button> 
    </form>
    <form action="/go_back_interview">
        <input type="submit" value="开始面试">
    </form>
    <div id="questions"></div>

    

    <script>
        var collectedText = ''; // 用于存储所有流式输入内容
        document.getElementById('interviewForm').onsubmit = function(e) {
            e.preventDefault();  // 防止表单的默认提交行为

            const eventSource = new EventSource(`/stream_questions`);

            document.getElementById('connectionStatus').innerText = '正在连接到猫猫...';

            // 当连接打开时
            eventSource.onopen = function () {
                console.log('连接已打开');
                // 可以在这里根据实际情况隐藏或修改 "正在连接..." 的显示
                document.getElementById('connectionStatus').innerText = '猫猫正在思考...';
                collectedText = ''
            };
            
            eventSource.onmessage = function(event) {
                const questionsDiv = document.getElementById('questions');
                console.log(event.data)
                if(event.data == "[DONE]") {
                    document.getElementById('connectionStatus').innerText = '猫猫已思考完毕，请开始面试！';
                }
                else {
                    let formattedData = event.data.split("¥¥").join("<br>");
                    collectedText += formattedData
                    questionsDiv.innerHTML = marked.parse(collectedText);
                }
            };

            eventSource.onerror = function() {
                eventSource.close();
            };
        };
    </script>
</body>
</html>